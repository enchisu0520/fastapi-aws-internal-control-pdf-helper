from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity

class InternalControlClassifier:
    def __init__(self):
        self.categories = {
            '設計及執行均有效 (全部法令規章)': """本公司民國○○年度之內部控制制度，依據自行評估的結果，謹聲明如下：
一、本公司確知建立、實施和維護內部控制制度係本公司董事會及經理人之責任，本公司業已建立此一制度。其目的係在對營運之效果及效率(含獲利、績效及保障資產安全等）、報導具可靠性、及時性、透明性及符合相關規範暨相關法令規章之遵循等目標的達成，提供合理的確保。
二、內部控制制度有其先天限制，不論設計如何完善，有效之內部控制制度亦僅能對上述三項目標之達成提供合理的確保；而且，由於環境、情況之改變，內部控制制度之有效性可能隨之改變。惟本公司之內部控制制度設有自我監督之機制，缺失一經辨認，本公司即採取更正之行動。
三、本公司係依據「公開發行公司建立內部控制制度處理準則」（以下簡稱「處理準則」）規定之內部控制制度有效性之判斷項目，判斷內部控制制度之設計及執行是否有效。該「處理準則」所採用之內部控制制度判斷項目，係為依管理控制之過程，將內部控制制度劃分為五個組成要素：1.控制環境，2.風險評估，3.控制作業，4.資訊與溝通，及5.監督作業。每個組成要素又包括若干項目。前述項目請參見「處理準則」之規定。
四、本公司業已採用上述內部控制制度判斷項目，評估內部控制制度之設計及執行的有效性。
五、本公司基於前項評估結果，認為本公司於民國○○年○○月○○日註2的內部控制制度﹙含對子公司之監督與管理﹚，包括瞭解營運之效果及效率目標達成之程度、報導係屬可靠、及時、透明及符合相關規範暨相關法令規章之遵循有關的內部控制制度等之設計及執行係屬有效，其能合理確保上述目標之達成。""",
            
            '設計及執行均有效 (主要法令規章)': """本公司民國○○年度之內部控制制度，依據自行評估的結果，謹聲明如下：
一、本公司確知建立、實施和維護內部控制制度係本公司董事會及經理人之責任，本公司業已建立此一制度。其目的係在對營運之效果及效率(含獲利、績效及保障資產安全等）、報導具可靠性、及時性、透明性及符合相關規範暨相關法令規章之遵循等目標的達成，提供合理的確保。
二、內部控制制度有其先天限制，不論設計如何完善，有效之內部控制制度亦僅能對上述三項目標之達成提供合理的確保；而且，由於環境、情況之改變，內部控制制度之有效性可能隨之改變。惟本公司之內部控制制度設有自我監督之機制，缺失一經辨認，本公司即採取更正之行動。
三、本公司係依據「公開發行公司建立內部控制制度處理準則」（以下簡稱「處理準則」）規定之內部控制制度有效性之判斷項目，判斷內部控制制度之設計及執行是否有效。該「處理準則」所採用之內部控制制度判斷項目，係為依管理控制之過程，將內部控制制度劃分為五個組成要素：1.控制環境，2.風險評估，3.控制作業，4.資訊與溝通，及5.監督作業。每個組成要素又包括若干項目。前述項目請參見「處理準則」之規定。
四、本公司業已採用上述內部控制制度判斷項目，評估內部控制制度之設計及執行的有效性。
五、本公司基於前項評估結果，認為本公司於民國○○年○○月○○日註2的內部控制制度﹙含對子公司之監督與管理﹚，包括瞭解營運之效果及效率目標達成之程度、報導係屬可靠、及時、透明及符合相關規範暨主要法令規章（如後附表）之遵循有關的內部控制制度等之設計及執行係屬有效，其能合理確保上述目標之達成。""",
            
            '設計或執行有重大缺失': """本公司民國○○年度之內部控制制度，依據自行評估的結果，謹聲明如下：
一、本公司確知建立、實施和維護內部控制制度係本公司董事會及經理人之責任，本公司業已建立此一制度。其目的係在對營運之效果及效率(含獲利、績效及保障資產安全等）、報導具可靠性、及時性、透明性及符合相關規範暨相關法令規章之遵循等目標的達成，提供合理的確保。
二、內部控制制度有其先天限制，不論設計如何完善，有效之內部控制制度亦僅能對上述三項目標之達成提供合理的確保；而且，由於環境、情況之改變，內部控制制度之有效性可能隨之改變。惟本公司之內部控制制度設有自我監督之機制，缺失一經辨認，本公司即採取更正之行動。
三、本公司係依據「公開發行公司建立內部控制制度處理準則」（以下簡稱「處理準則」）規定之內部控制制度有效性之判斷項目，判斷內部控制制度之設計及執行是否有效。該「處理準則」所採用之內部控制制度判斷項目，係為依管理控制之過程，將內部控制制度劃分為五個組成要素：1.控制環境，2.風險評估，3.控制作業，4.資訊與溝通，及5.監督作業。每個組成要素又包括若干項目。前述項目請參見「處理準則」之規定。
四、本公司業已採用上述內部控制制度判斷項目，評估內部控制制度之設計及執行的有效性。
五、本公司之評估發現下列重大缺失：（列舉各項重大缺失及其對達成上述目標之影響）
六、本公司基於前項評估結果，認為本公司於民國○○年○○月○○日註2之內部控制制度﹙含對子公司之監督與管理﹚，包括瞭解營運之效果及效率目標達成之程度、報導係屬可靠、及時、透明及符合相關規範暨相關法令規章之遵循有關的內部控制制度等之設計及執行，除前項所述者外，其餘係屬有效。""",
            
            '設計及執行均有效 (會計師審查)': """本公司民國○○年度之內部控制制度，依據自行評估的結果，謹聲明如下：
一、本公司確知建立、實施和維護內部控制制度係本公司董事會及經理人之責任，本公司業已建立此一制度。其目的係在對營運之效果及效率(含獲利、績效及保障資產安全等）、報導具可靠性、及時性、透明性及符合相關規範暨相關法令規章之遵循等目標的達成，提供合理的確保。
二、內部控制制度有其先天限制，不論設計如何完善，有效之內部控制制度亦僅能對上述三項目標之達成提供合理的確保；而且，由於環境、情況之改變，內部控制制度之有效性可能隨之改變。惟本公司之內部控制制度設有自我監督之機制，缺失一經辨認，本公司即採取更正之行動。
三、本公司係依據「公開發行公司建立內部控制制度處理準則」（以下簡稱「處理準則」）規定之內部控制制度有效性之判斷項目，判斷內部控制制度之設計及執行是否有效。該「處理準則」所採用之內部控制制度判斷項目，係為依管理控制之過程，將內部控制制度劃分為五個組成要素：1.控制環境，2.風險評估，3.控制作業，4.資訊與溝通，及5.監督作業。每個組成要素又包括若干項目。前述項目請參見「處理準則」之規定。
四、公司業已採用上述內部控制制度判斷項目，評估內部控制制度之設計及執行的有效性。
五、本公司基於前項評估結果，認為本公司於民國○○年○○月○○日註3之內部控制制度﹙含對子公司之監督與管理﹚，包括瞭解營運之效果及效率目標達成之程度、報導係屬可靠、及時、透明及符合相關規範暨相關法令規章之遵循有關的內部控制制度等之設計及執行係屬有效，其能合理確保上述目標之達成。
六、為○○○○之需要，本公司依據「處理準則」第○○條之規定，委託會計師專案審查上開期間與外部財務報導之可靠性及與保障資產安全(使資產不致在未經授權之情況下取得、使用或處分)有關的內部控制制度，如前項所述，其設計及執行係屬有效，並無影響財務資訊之記錄、處理、彙總及報告可靠性之重大缺失，亦無影響保障資產安全，使資產在未經授權之情況下逕行取得、使用或處分之重大缺失。""",
            
            '設計或執行有重大缺失 (會計師審查)': """本公司民國○○年度之內部控制制度，依據自行評估的結果，謹聲明如下：
一、本公司確知建立、實施和維護內部控制制度係本公司董事會及經理人之責任，本公司業已建立此一制度。其目的係在對營運之效果及效率(含獲利、績效及保障資產安全等）、報導具可靠性、及時性、透明性及符合相關規範暨相關法令規章之遵循等目標的達成，提供合理的確保。
二、內部控制制度有其先天限制，不論設計如何完善，有效之內部控制制度亦僅能對上述三項目標之達成提供合理的確保；而且，由於環境、情況之改變，內部控制制度之有效性可能隨之改變。惟本公司之內部控制制度設有自我監督之機制，缺失一經辨認，本公司即採取更正之行動。
三、本公司係依據「公開發行公司建立內部控制制度處理準則」（以下簡稱「處理準則」）規定之內部控制制度有效性之判斷項目，判斷內部控制制度之設計及執行是否有效。該「處理準則」所採用之內部控制制度判斷項目，係為依管理控制之過程，將內部控制制度劃分為五個組成要素：1.控制環境，2.風險評估，3.控制作業，4.資訊與溝通，及5.監督作業。每個組成要素又包括若干項目。前述項目請參見「處理準則」之規定。
四、本公司業已採用上述內部控制制度判斷項目，評估內部控制制度之設計及執行的有效性。
五、本公司之評估發現下列重大缺失：（請列舉重大缺失及其對達成上述目標之影響）
六、本公司基於前項評估結果，認為本公司於民國○○年○○月○○日註4之內部控制制度﹙含對子公司之監督與管理﹚，包括瞭解營運之效果及效率目標達成之程度、報導係屬可靠、及時、透明及符合相關規範暨相關法令規章之遵循有關的內部控制制度等之設計及執行，除前項所述者外，其餘係屬有效。
七、為○○○○之需要，本公司依據「處理準則」第○○條之規定，委託會計師專案審查上開期間與外部財務報導之可靠性及與保障資產安全(使資產不致在未經授權之情況下取得、使用或處分)有關的內部控制制度，除第五項所列重大缺失外，其餘係屬有效，並無其他會影響財務資訊之記錄、處理、彙總及報告可靠性之重大缺失，亦無其他會影響保障資產安全，使資產在未經授權之情況下逕行取得、使用或處分之重大缺失。"""
        }

    def classify_document(self, input_text):
        documents = list(self.categories.values()) + [input_text]

        # 計算TF-IDF向量
        vectorizer = TfidfVectorizer()
        tfidf_matrix = vectorizer.fit_transform(documents)

        # 計算輸入資料與類別的cosine similarity
        similarity_scores = cosine_similarity(tfidf_matrix[-1], tfidf_matrix[:-1])

        # 找出最高相似度
        max_similarity_idx = similarity_scores.argmax()

        # 取得最相似的類別名稱
        category_name = list(self.categories.keys())[max_similarity_idx]

        return category_name, similarity_scores[0, max_similarity_idx]

